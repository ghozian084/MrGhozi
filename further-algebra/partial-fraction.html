<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Partial Fractions</title>
    
    <!-- 1. CONFIGURE MATHJAX (Must be before loading the script) -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>

    <!-- 2. LOAD MATHJAX -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #4834d4;
            --secondary: #686de0;
            --success: #6ab04c;
            --error: #eb4d4b;
            --bg: #f7f1e3;
            --card: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .main-card {
            background: var(--card);
            width: 100%;
            max-width: 850px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        /* Header & Progress */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        .progress-container {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            border-radius: 4px;
            transition: width 0.4s ease;
        }

        /* Slide Logic */
        .slide {
            display: none; /* Hidden by default */
            animation: fadeUp 0.5s ease forwards;
        }
        .slide.active { display: block; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 { color: var(--primary); margin: 0; font-size: 1.8rem; }
        h2 { color: var(--secondary); margin-top: 0; }
        p { line-height: 1.6; color: #444; font-size: 1.05rem; }

        /* Interactive Input Elements */
        .math-input {
            width: 70px;
            padding: 5px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            transition: 0.3s;
            background: #fff;
        }
        
        .math-input:focus { outline: none; border-color: var(--primary); }
        .math-input.correct { border-color: var(--success); background-color: #badc58; color: #fff; }
        .math-input.wrong { border-color: var(--error); background-color: #ffbe76; color: #fff;}

        .step-box {
            background: #f8f9fa;
            border-left: 5px solid var(--secondary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.5s ease;
            display: none; /* Hidden until triggered */
        }

        .step-box.visible { 
            display: block; 
            opacity: 1; 
            transform: translateX(0); 
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            margin: 5px;
        }
        .btn:hover { background: var(--secondary); }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .fraction-builder {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            background: #eef;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; }

        .feedback-msg { font-weight: bold; min-height: 25px; margin: 10px 0; }
        .text-success { color: var(--success); }
        .text-error { color: var(--error); }

    </style>
</head>
<body>

<div class="main-card">
    <div class="header">
        <h1>P3 Algebra: Partial Fractions</h1>
        <span id="slide-indicator">1 / 4</span>
    </div>
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <!-- SLIDE 1: Conceptual Intro -->
    <div class="slide active" id="slide1">
        <h2>1. The Concept</h2>
        <p>Partial fractions allow us to split complex fractions into simpler ones. This is crucial for integration.</p>
        
        <div class="step-box visible">
            <p><strong>Interactive Check:</strong></p>
            <p>If we want to split $$ \frac{5x-1}{(x-1)(x+3)} $$ into partial fractions, what should the structure look like?</p>
            
            <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                <button class="btn btn-outline" onclick="checkIntro(this, false)">$ A(x-1) + B(x+3) $</button>
                <button class="btn btn-outline" onclick="checkIntro(this, true)">$ \frac{A}{x-1} + \frac{B}{x+3} $</button>
                <button class="btn btn-outline" onclick="checkIntro(this, false)">$ \frac{A}{(x-1)^2} $</button>
            </div>
            <div id="intro-feedback" class="feedback-msg"></div>
        </div>
    </div>

    <!-- SLIDE 2: Linear Factors Interactive Solver -->
    <div class="slide" id="slide2">
        <h2>2. Solving Linear Factors</h2>
        <p>Let's solve for the constants $A$ and $B$ together.</p>
        <p>Problem: $$ \frac{5x+7}{(x+1)(x+2)} \equiv \frac{A}{x+1} + \frac{B}{x+2} $$</p>

        <!-- Step 1 -->
        <div class="step-box visible" id="s2-step1">
            <strong>Step 1: Remove Denominators</strong>
            <p>Multiply everything by $(x+1)(x+2)$. What is the resulting equation?</p>
            $$ 5x+7 \equiv A(\dots) + B(\dots) $$
            <p>
                $A$ is multiplied by: <input type="text" class="math-input" style="width:100px" placeholder="e.g. x+5" onchange="validateText(this, 'x+2', 's2-step2')"> 
                $B$ is multiplied by: <input type="text" class="math-input" style="width:100px" placeholder="e.g. x-3" onchange="validateText(this, 'x+1', 's2-step2')">
            </p>
            <small style="color:#888">Tip: Type "x+2" and "x+1". Press Enter or Click outside the box to check.</small>
        </div>

        <!-- Step 2 -->
        <div class="step-box" id="s2-step2">
            <strong>Step 2: Substitution Method</strong>
            <p>We have: $5x+7 = A(x+2) + B(x+1)$</p>
            
            <p>To find <strong>A</strong>, let $x = -1$. This eliminates $B$.</p>
            <p>Left Side ($5(-1)+7$): <strong>2</strong></p>
            <p>Right Side ($A(-1+2)$): <strong>1A</strong></p>
            <p>So, $A =$ <input type="number" class="math-input" onkeyup="validateNum(this, 2, 's2-step3')"></p>
        </div>

        <!-- Step 3 -->
        <div class="step-box" id="s2-step3">
            <strong>Step 3: Find B</strong>
            <p>To find <strong>B</strong>, let $x = -2$. This eliminates $A$.</p>
            <p>Left Side ($5(-2)+7$): <input type="number" class="math-input" style="width:80px" placeholder="?" onkeyup="validateNum(this, -3, null)"></p>
            <p>Right Side ($B(-2+1)$): $-1B$</p>
            <p>So, $-3 = -B \implies B =$ <input type="number" class="math-input" onkeyup="validateNum(this, 3, 's2-final')"></p>
        </div>

        <div class="step-box" id="s2-final" style="background-color: #d1e7dd; border-color: #198754;">
            <h3>ðŸŽ‰ Solved!</h3>
            $$ \frac{5x+7}{(x+1)(x+2)} \equiv \frac{2}{x+1} + \frac{3}{x+2} $$
        </div>
    </div>

    <!-- SLIDE 3: Repeated Factors Builder -->
    <div class="slide" id="slide3">
        <h2>3. The Repeated Factor Trap</h2>
        <p>When you have $(x+3)^2$, you need a term for power 1 AND power 2.</p>
        <p><strong>Task:</strong> Build the correct form for: $$ \frac{9}{(x-1)(x+2)^2} $$</p>

        <div class="fraction-builder">
            <!-- Dropdown 1 -->
            <div style="display:flex; flex-direction:column; align-items:center;">
                <small>Term 1</small>
                <select id="rep1" onchange="checkRepeatedStructure()">
                    <option value="0">Select...</option>
                    <option value="1">A / (x-1)</option>
                    <option value="2">A / (x+2)</option>
                </select>
            </div>
            <span>+</span>
            <!-- Dropdown 2 -->
             <div style="display:flex; flex-direction:column; align-items:center;">
                <small>Term 2</small>
                <select id="rep2" onchange="checkRepeatedStructure()">
                    <option value="0">Select...</option>
                    <option value="2">B / (x+2)</option>
                    <option value="3">B / (x+2)^2</option>
                </select>
            </div>
            <span>+</span>
            <!-- Dropdown 3 -->
             <div style="display:flex; flex-direction:column; align-items:center;">
                <small>Term 3</small>
                <select id="rep3" onchange="checkRepeatedStructure()">
                    <option value="0">Select...</option>
                    <option value="2">C / (x+2)</option>
                    <option value="3">C / (x+2)^2</option>
                </select>
            </div>
        </div>
        <div id="repeated-feedback" class="feedback-msg"></div>
        
        <div class="step-box" id="repeated-steps">
            <p>Correct! The identity is:</p>
            $$ 9 \equiv A(x+2)^2 + B(x-1)(x+2) + C(x-1) $$
            <p>If we let $x=-2$, we can find $C$ immediately.</p>
            <p>$9 = C(-2-1) \implies 9 = -3C$</p>
            <p>$C =$ <input type="number" class="math-input" onkeyup="validateNum(this, -3, null)"></p>
        </div>
    </div>

    <!-- SLIDE 4: Improper Fractions Animation -->
    <div class="slide" id="slide4">
        <h2>4. Improper Fractions (Top Heavy)</h2>
        <p>If degree of Top $\ge$ Bottom, you MUST divide first.</p>
        <p>$$ \text{Example: } \frac{x^2 + 1}{x^2 - 1} $$</p>
        
        <div style="text-align: center; margin: 20px;">
            <button class="btn" id="anim-btn" onclick="nextAnimStep()">Show Next Step</button>
        </div>

        <div id="anim-container">
            <div class="step-box" id="anim-1">
                <strong>Step 1: Check Degrees</strong><br>
                Numerator: $x^2$ (Degree 2). Denominator: $x^2$ (Degree 2).<br>
                $2 \ge 2$, so it is Improper.
            </div>
            <div class="step-box" id="anim-2">
                <strong>Step 2: Long Division</strong><br>
                How many times does $x^2$ go into $x^2$? <strong>1 time</strong>.<br>
                $$ (x^2+1) \div (x^2-1) = 1 \text{ rem } 2 $$
            </div>
            <div class="step-box" id="anim-3">
                <strong>Step 3: Rewrite</strong><br>
                $$ 1 + \frac{2}{x^2-1} $$
            </div>
            <div class="step-box" id="anim-4">
                <strong>Step 4: Solve Partial Fractions for Remainder</strong><br>
                $$ \frac{2}{(x-1)(x+1)} = \frac{1}{x-1} - \frac{1}{x+1} $$
                <br><strong>Final Answer:</strong>
                $$ 1 + \frac{1}{x-1} - \frac{1}{x+1} $$
            </div>
        </div>
    </div>

    <div class="navigation">
        <button class="btn" id="prevBtn" onclick="changeSlide(-1)" disabled>Previous</button>
        <button class="btn" id="nextBtn" onclick="changeSlide(1)">Next</button>
    </div>

</div>

<script>
    /* STATE MANAGEMENT */
    let currentSlide = 0;
    const totalSlides = 4;
    
    function updateUI() {
        // Update Slides
        document.querySelectorAll('.slide').forEach((s, i) => {
            s.classList.remove('active');
            if(i === currentSlide) s.classList.add('active');
        });

        // Update Progress
        document.getElementById('progress-bar').style.width = ((currentSlide + 1) / totalSlides * 100) + "%";
        document.getElementById('slide-indicator').innerText = `${currentSlide + 1} / ${totalSlides}`;

        // Update Buttons
        document.getElementById('prevBtn').disabled = currentSlide === 0;
        document.getElementById('nextBtn').innerText = currentSlide === totalSlides - 1 ? "Finish" : "Next";
    }

    function changeSlide(dir) {
        currentSlide += dir;
        if(currentSlide < 0) currentSlide = 0;
        if(currentSlide >= totalSlides) currentSlide = totalSlides - 1;
        updateUI();
    }

    /* LOGIC: Slide 1 Intro */
    function checkIntro(btn, isCorrect) {
        const fb = document.getElementById('intro-feedback');
        if(isCorrect) {
            fb.innerHTML = "<span class='text-success'>Correct! Separate terms for each factor.</span>";
            btn.style.background = "#badc58";
            btn.style.borderColor = "#badc58";
            btn.style.color = "white";
            // Re-render any math in feedback
            MathJax.typesetPromise();
        } else {
            fb.innerHTML = "<span class='text-error'>Not quite. Try again!</span>";
            btn.style.borderColor = "#eb4d4b";
        }
    }

    /* LOGIC: Slide 2 Validation */
    function validateText(input, expected, nextId) {
        const val = input.value.replace(/\s/g, '').toLowerCase();
        const exp = expected.replace(/\s/g, '').toLowerCase();

        if (val === exp || val === `(${exp})`) {
            input.classList.add('correct');
            input.classList.remove('wrong');
            if(nextId) {
                document.getElementById(nextId).classList.add('visible');
                // Wait a moment for the transition, then render math inside the new box
                setTimeout(() => MathJax.typesetPromise(), 100);
            }
        } else {
            input.classList.add('wrong');
        }
    }

    function validateNum(input, expected, nextId) {
        if (parseInt(input.value) === expected) {
            input.classList.add('correct');
            input.classList.remove('wrong');
            if(nextId) {
                document.getElementById(nextId).classList.add('visible');
                setTimeout(() => MathJax.typesetPromise(), 100);
            }
        } else {
            input.classList.add('wrong');
        }
    }

    /* LOGIC: Slide 3 Structure Builder */
    function checkRepeatedStructure() {
        const v1 = document.getElementById('rep1').value;
        const v2 = document.getElementById('rep2').value;
        const v3 = document.getElementById('rep3').value;
        const fb = document.getElementById('repeated-feedback');
        const stepBox = document.getElementById('repeated-steps');

        // We need 1, 2, and 3 selected in any fields.
        const values = [v1, v2, v3].sort(); 
        
        if (values.includes("1") && values.includes("2") && values.includes("3")) {
            fb.innerHTML = "<span class='text-success'>Perfect! You have all the necessary terms.</span>";
            stepBox.classList.add('visible');
            MathJax.typesetPromise();
        } else {
            fb.innerHTML = "<span style='color:#888'>Keep trying. You need one term for $(x-1)$, one for $(x+2)$, and one for $(x+2)^2$.</span>";
            stepBox.classList.remove('visible');
            MathJax.typesetPromise();
        }
    }

    /* LOGIC: Slide 4 Animation */
    let animStep = 0;
    function nextAnimStep() {
        animStep++;
        const el = document.getElementById(`anim-${animStep}`);
        if(el) {
            el.classList.add('visible');
            MathJax.typesetPromise();
        }
        if(animStep === 4) document.getElementById('anim-btn').style.display = "none";
    }

    // Init
    updateUI();

</script>
</body>
</html>
